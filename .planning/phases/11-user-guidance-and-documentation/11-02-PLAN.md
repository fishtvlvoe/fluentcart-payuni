---
phase: 11-user-guidance-and-documentation
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/Admin/UserGuidePage.php
  - assets/css/payuni-user-guide.css
  - assets/js/payuni-user-guide.js
autonomous: true

must_haves:
  truths:
    - "FAQ section displays common questions organized by category"
    - "Troubleshooting section provides error message reference table"
    - "Troubleshooting section provides Webhook debugging checklist"
    - "FAQ items are collapsible accordion-style"
    - "Error codes link to relevant troubleshooting steps"
  artifacts:
    - path: "src/Admin/UserGuidePage.php"
      provides: "Complete user guide with FAQ and troubleshooting content"
      min_lines: 350
    - path: "assets/css/payuni-user-guide.css"
      provides: "Accordion and table styling for FAQ/troubleshooting"
      min_lines: 180
    - path: "assets/js/payuni-user-guide.js"
      provides: "Accordion toggle functionality"
      min_lines: 80
  key_links:
    - from: "src/Admin/UserGuidePage.php"
      to: "FAQ and Troubleshooting sections"
      via: "renderFaqSection and renderTroubleshootingSection methods"
      pattern: "renderFaq|renderTroubleshooting"
---

<objective>
Add FAQ and Troubleshooting sections to User Guide page.

Purpose: Help merchants quickly find answers to common questions and debug payment issues using structured error references and checklists.
Output: Complete User Guide page with FAQ accordion and troubleshooting tools (error table, checklists, flow diagrams).
</objective>

<execution_context>
@/Users/fishtv/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fishtv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/fishtv/Development/fluentcart-payuni/.planning/PROJECT.md
@/Users/fishtv/Development/fluentcart-payuni/.planning/ROADMAP.md
@/Users/fishtv/Development/fluentcart-payuni/.planning/STATE.md
@/Users/fishtv/Development/fluentcart-payuni/.planning/REQUIREMENTS.md
@/Users/fishtv/Development/fluentcart-payuni/.planning/phases/11-user-guidance-and-documentation/11-CONTEXT.md

# Reference Plan 01 outputs
@/Users/fishtv/Development/fluentcart-payuni/src/Admin/UserGuidePage.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add FAQ section with categorized collapsible questions</name>
  <files>src/Admin/UserGuidePage.php, assets/css/payuni-user-guide.css, assets/js/payuni-user-guide.js</files>
  <action>
**Part A: Add `renderFaqSection(): string` method to UserGuidePage.php**

Implement FAQ content organized by category (from CONTEXT.md):

**Category 1: 金流設定**
```html
<div class="faq-category">
    <h3>金流設定</h3>
    <div class="faq-item">
        <button class="faq-question">如何獲取 PayUNi 商店代號 (MerID)?</button>
        <div class="faq-answer">
            <ol>
                <li>登入 <a href="https://www.payuni.com.tw" target="_blank">PayUNi 商戶後台</a></li>
                <li>進入「商店管理」→「商店設定」</li>
                <li>複製「商店代號」欄位的值</li>
                <li>在 FluentCart 付款設定中填入此代號</li>
            </ol>
        </div>
    </div>
    <div class="faq-item">
        <button class="faq-question">如何切換測試/正式環境?</button>
        <div class="faq-answer">
            <p>PayUNi 使用不同的 API 端點和憑證區分測試/正式環境：</p>
            <ol>
                <li>進入 FluentCart → 付款設定 → PayUNi 信用卡</li>
                <li>選擇「環境」欄位 (測試/正式)</li>
                <li>填入對應環境的 MerID、Hash Key、Hash IV</li>
                <li><strong>注意：</strong>測試環境使用測試用憑證，正式環境使用正式憑證</li>
            </ol>
        </div>
    </div>
</div>
```

**Category 2: Webhook 調試**
```html
<div class="faq-category">
    <h3>Webhook 調試</h3>
    <div class="faq-item">
        <button class="faq-question">Webhook 沒有觸發怎麼辦?</button>
        <div class="faq-answer">
            <p>請依序檢查以下項目：</p>
            <ol>
                <li><strong>確認 URL 設定</strong>：在 PayUNi 後台確認 NotifyURL 已正確設定</li>
                <li><strong>SSL 憑證</strong>：PayUNi 要求 HTTPS，確認網站有有效的 SSL 憑證</li>
                <li><strong>防火牆</strong>：確認伺服器防火牆允許 PayUNi IP 範圍的請求</li>
                <li><strong>查看日誌</strong>：進入 PayUNi Webhook 記錄頁面檢視是否有接收到請求</li>
            </ol>
            <p>詳細排查步驟請參閱 <a href="#troubleshooting">疑難排解</a> 區塊。</p>
        </div>
    </div>
    <div class="faq-item">
        <button class="faq-question">如何驗證 Webhook 運作正常?</button>
        <div class="faq-answer">
            <ol>
                <li>進入 PayUNi 設定頁面</li>
                <li>點擊「測試連線」按鈕</li>
                <li>如顯示「Webhook URL 可連線」表示基本連線正常</li>
                <li>實際付款測試：完成一筆測試交易後，檢查 Webhook 記錄是否有新紀錄</li>
            </ol>
        </div>
    </div>
</div>
```

**Category 3: 訂閱續扣問題**
```html
<div class="faq-category">
    <h3>訂閱續扣問題</h3>
    <div class="faq-item">
        <button class="faq-question">訂閱續扣失敗怎麼辦?</button>
        <div class="faq-answer">
            <p>續扣失敗通常有以下原因：</p>
            <ul>
                <li><strong>餘額不足</strong>：提醒客戶補充信用卡額度</li>
                <li><strong>卡片過期</strong>：請客戶更新付款卡片</li>
                <li><strong>銀行拒絕</strong>：請客戶聯繫發卡銀行</li>
            </ul>
            <p><strong>系統自動重試機制：</strong></p>
            <ul>
                <li>首次失敗後 24 小時重試</li>
                <li>第二次失敗後 48 小時重試</li>
                <li>第三次失敗後 72 小時重試</li>
            </ul>
            <p>如需手動處理，請在訂閱詳情頁查看失敗原因。</p>
        </div>
    </div>
    <div class="faq-item">
        <button class="faq-question">如何更新信用卡資訊?</button>
        <div class="faq-answer">
            <p>目前版本客戶需透過以下方式更新：</p>
            <ol>
                <li>客戶登入網站進入「我的帳戶」→「訂閱」</li>
                <li>選擇要更新的訂閱</li>
                <li>點擊「更新付款方式」</li>
                <li>輸入新的信用卡資訊並完成 3D 驗證</li>
            </ol>
        </div>
    </div>
</div>
```

**Category 4: ATM 號碼查詢**
```html
<div class="faq-category">
    <h3>ATM 虛擬帳號</h3>
    <div class="faq-item">
        <button class="faq-question">客戶問我 ATM 虛擬帳號在哪裡?</button>
        <div class="faq-answer">
            <p>ATM 虛擬帳號可在以下位置查看：</p>
            <ol>
                <li><strong>訂單確認郵件</strong>：客戶下單後會收到包含帳號的確認信</li>
                <li><strong>訂單詳情頁</strong>：客戶登入網站 →「我的訂單」→ 點擊該訂單</li>
                <li><strong>後台查詢</strong>：FluentCart 訂單 → 點擊訂單 → PayUNi 交易資訊區塊</li>
            </ol>
        </div>
    </div>
    <div class="faq-item">
        <button class="faq-question">ATM 付款期限多久?</button>
        <div class="faq-answer">
            <p>ATM 虛擬帳號預設有效期限為 <strong>7 天</strong>（PayUNi 預設值）。</p>
            <p>過期後帳號失效，訂單會自動標記為「已取消」。</p>
            <p>如需調整期限，請聯繫 PayUNi 客服設定。</p>
        </div>
    </div>
</div>
```

**Part B: Update CSS for FAQ accordion styling**

Add to `assets/css/payuni-user-guide.css`:

```css
/* FAQ Section */
.payuni-user-guide .faq-category {
    margin-bottom: 24px;
}

.payuni-user-guide .faq-category h3 {
    font-size: 16px;
    color: #1d2327;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid #2271b1;
}

.payuni-user-guide .faq-item {
    margin-bottom: 8px;
    border: 1px solid #dcdcde;
    border-radius: 4px;
    overflow: hidden;
}

.payuni-user-guide .faq-question {
    display: flex;
    align-items: center;
    width: 100%;
    padding: 12px 16px;
    background: #f6f7f7;
    border: none;
    text-align: left;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: #1d2327;
    transition: background-color 0.2s;
}

.payuni-user-guide .faq-question::before {
    content: '+';
    margin-right: 12px;
    font-size: 18px;
    font-weight: bold;
    color: #2271b1;
    transition: transform 0.2s;
}

.payuni-user-guide .faq-item.open .faq-question::before {
    content: '−';
}

.payuni-user-guide .faq-question:hover {
    background: #eaebec;
}

.payuni-user-guide .faq-answer {
    display: none;
    padding: 16px;
    background: #fff;
    border-top: 1px solid #dcdcde;
}

.payuni-user-guide .faq-item.open .faq-answer {
    display: block;
}

.payuni-user-guide .faq-answer ol,
.payuni-user-guide .faq-answer ul {
    margin: 12px 0;
    padding-left: 24px;
}

.payuni-user-guide .faq-answer li {
    margin-bottom: 8px;
}
```

**Part C: Update JavaScript for accordion functionality**

Add to `assets/js/payuni-user-guide.js`:

```javascript
// FAQ Accordion functionality
$('.faq-question').on('click', function() {
    var $item = $(this).closest('.faq-item');
    var wasOpen = $item.hasClass('open');

    // Optional: Close other items in same category (accordion behavior)
    // $item.siblings('.faq-item').removeClass('open');

    // Toggle current item
    $item.toggleClass('open');
});

// Expand FAQ if linked directly with hash like #faq-webhook
var hash = window.location.hash;
if (hash && hash.startsWith('#faq-')) {
    var faqId = hash.substring(5);  // Remove '#faq-'
    var $targetFaq = $('[data-faq-id="' + faqId + '"]');
    if ($targetFaq.length) {
        $targetFaq.closest('.faq-item').addClass('open');
    }
}
```
  </action>
  <verify>
1. FAQ section visible when clicking "常見問題" in sidebar
2. 4 categories displayed: 金流設定, Webhook 調試, 訂閱續扣問題, ATM 虛擬帳號
3. Clicking FAQ question expands/collapses answer
4. Each category has 2 questions minimum
  </verify>
  <done>
- FAQ section with 4 categories and 8+ questions
- Collapsible accordion functionality
- Internal links to troubleshooting section
- Consistent styling with WordPress admin UI
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Troubleshooting section with error table and checklists</name>
  <files>src/Admin/UserGuidePage.php, assets/css/payuni-user-guide.css</files>
  <action>
**Part A: Add `renderTroubleshootingSection(): string` method to UserGuidePage.php**

Implement troubleshooting content (from CONTEXT.md):

**1. 錯誤訊息對照表**
```html
<div class="troubleshooting-section">
    <h3>常見錯誤訊息對照表</h3>
    <table class="error-table">
        <thead>
            <tr>
                <th>錯誤代碼/訊息</th>
                <th>可能原因</th>
                <th>解決方法</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>Hash 驗證失敗</code></td>
                <td>Hash Key 或 Hash IV 設定錯誤</td>
                <td>確認 FluentCart 中的 Hash Key/IV 與 PayUNi 後台一致</td>
            </tr>
            <tr>
                <td><code>商店代號不存在</code></td>
                <td>MerID 設定錯誤或環境不匹配</td>
                <td>確認使用正確環境的 MerID（測試/正式）</td>
            </tr>
            <tr>
                <td><code>交易金額錯誤</code></td>
                <td>金額格式不正確或超出限制</td>
                <td>確認金額為整數且在 PayUNi 允許範圍內</td>
            </tr>
            <tr>
                <td><code>信用卡授權失敗</code></td>
                <td>卡片問題（餘額不足、過期、被鎖）</td>
                <td>請客戶確認卡片狀態或使用其他卡片</td>
            </tr>
            <tr>
                <td><code>3D 驗證失敗</code></td>
                <td>客戶未完成 3D 驗證或驗證超時</td>
                <td>請客戶重新付款並完成 3D 驗證</td>
            </tr>
            <tr>
                <td><code>Webhook 簽章驗證失敗</code></td>
                <td>Webhook 資料被竄改或 Key 不正確</td>
                <td>確認 Hash Key 正確，檢查伺服器時間是否同步</td>
            </tr>
        </tbody>
    </table>
</div>
```

**2. Webhook 排查檢查清單**
```html
<div class="troubleshooting-section">
    <h3>Webhook 無法運作檢查清單</h3>
    <div class="checklist">
        <div class="checklist-intro">
            <p>如果 Webhook 無法正常接收，請依序檢查以下項目：</p>
        </div>
        <ul class="checklist-items">
            <li>
                <span class="checklist-checkbox">☐</span>
                <span class="checklist-text">
                    <strong>URL 是否正確</strong> - 在 PayUNi 後台確認 NotifyURL 已正確設定
                    <br><small>可在「PayUNi 設定」頁面複製正確的 Webhook URL</small>
                </span>
            </li>
            <li>
                <span class="checklist-checkbox">☐</span>
                <span class="checklist-text">
                    <strong>HTTPS 是否有效</strong> - PayUNi 要求使用有效的 SSL 憑證
                    <br><small>使用瀏覽器確認網站顯示安全鎖頭圖示</small>
                </span>
            </li>
            <li>
                <span class="checklist-checkbox">☐</span>
                <span class="checklist-text">
                    <strong>防火牆是否允許</strong> - 確認伺服器防火牆允許外部 POST 請求
                    <br><small>聯繫主機商確認 PayUNi 的 IP 範圍可以存取</small>
                </span>
            </li>
            <li>
                <span class="checklist-checkbox">☐</span>
                <span class="checklist-text">
                    <strong>網站是否可公開訪問</strong> - Webhook 只能發送到公開網站
                    <br><small>localhost 或內網環境無法接收 Webhook</small>
                </span>
            </li>
            <li>
                <span class="checklist-checkbox">☐</span>
                <span class="checklist-text">
                    <strong>伺服器日誌有無錯誤</strong> - 檢查 PHP 錯誤日誌
                    <br><small>查看 wp-content/debug.log 或主機 error_log</small>
                </span>
            </li>
        </ul>
    </div>
</div>
```

**3. 訂單未付款排查流程圖**
```html
<div class="troubleshooting-section">
    <h3>訂單未付款排查流程</h3>
    <div class="flowchart">
        <div class="flowchart-step start">
            <span>訂單狀態為「待付款」</span>
        </div>
        <div class="flowchart-arrow">↓</div>
        <div class="flowchart-decision">
            <span>客戶有收到付款資訊嗎？</span>
        </div>
        <div class="flowchart-branches">
            <div class="flowchart-branch">
                <span class="branch-label">否</span>
                <div class="flowchart-arrow">↓</div>
                <div class="flowchart-action">
                    檢查訂單確認郵件是否成功發送
                </div>
            </div>
            <div class="flowchart-branch">
                <span class="branch-label">是</span>
                <div class="flowchart-arrow">↓</div>
                <div class="flowchart-decision">
                    <span>客戶有完成付款嗎？</span>
                </div>
                <div class="flowchart-branches nested">
                    <div class="flowchart-branch">
                        <span class="branch-label">否</span>
                        <div class="flowchart-arrow">↓</div>
                        <div class="flowchart-action">
                            提醒客戶付款期限
                        </div>
                    </div>
                    <div class="flowchart-branch">
                        <span class="branch-label">是</span>
                        <div class="flowchart-arrow">↓</div>
                        <div class="flowchart-action">
                            檢查 Webhook 記錄是否有收到通知
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
```

**Part B: Update CSS for troubleshooting section styling**

Add to `assets/css/payuni-user-guide.css`:

```css
/* Troubleshooting Section */
.payuni-user-guide .troubleshooting-section {
    margin-bottom: 32px;
}

.payuni-user-guide .troubleshooting-section h3 {
    font-size: 16px;
    color: #1d2327;
    margin-bottom: 16px;
}

/* Error Table */
.payuni-user-guide .error-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

.payuni-user-guide .error-table th,
.payuni-user-guide .error-table td {
    padding: 12px;
    border: 1px solid #dcdcde;
    text-align: left;
    vertical-align: top;
}

.payuni-user-guide .error-table th {
    background: #f6f7f7;
    font-weight: 600;
}

.payuni-user-guide .error-table code {
    background: #f0f0f1;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 12px;
    color: #d63638;
}

/* Checklist */
.payuni-user-guide .checklist {
    background: #f6f7f7;
    border: 1px solid #dcdcde;
    border-radius: 4px;
    padding: 20px;
}

.payuni-user-guide .checklist-intro {
    margin-bottom: 16px;
}

.payuni-user-guide .checklist-items {
    list-style: none;
    padding: 0;
    margin: 0;
}

.payuni-user-guide .checklist-items li {
    display: flex;
    align-items: flex-start;
    padding: 12px;
    background: #fff;
    border: 1px solid #dcdcde;
    border-radius: 4px;
    margin-bottom: 8px;
}

.payuni-user-guide .checklist-checkbox {
    font-size: 18px;
    margin-right: 12px;
    color: #2271b1;
}

.payuni-user-guide .checklist-text {
    flex: 1;
}

.payuni-user-guide .checklist-text small {
    color: #646970;
}

/* Flowchart */
.payuni-user-guide .flowchart {
    text-align: center;
    padding: 20px;
    background: #f6f7f7;
    border: 1px solid #dcdcde;
    border-radius: 4px;
}

.payuni-user-guide .flowchart-step,
.payuni-user-guide .flowchart-decision,
.payuni-user-guide .flowchart-action {
    display: inline-block;
    padding: 12px 24px;
    margin: 8px;
    border-radius: 4px;
}

.payuni-user-guide .flowchart-step.start {
    background: #2271b1;
    color: #fff;
    border-radius: 20px;
}

.payuni-user-guide .flowchart-decision {
    background: #fff;
    border: 2px solid #2271b1;
    transform: rotate(0deg);
}

.payuni-user-guide .flowchart-action {
    background: #fff;
    border: 1px solid #dcdcde;
}

.payuni-user-guide .flowchart-arrow {
    font-size: 20px;
    color: #646970;
}

.payuni-user-guide .flowchart-branches {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-top: 16px;
}

.payuni-user-guide .flowchart-branch {
    text-align: center;
}

.payuni-user-guide .branch-label {
    display: inline-block;
    padding: 4px 12px;
    background: #dcdcde;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

@media (max-width: 782px) {
    .payuni-user-guide .flowchart-branches {
        flex-direction: column;
        gap: 16px;
    }
}
```
  </action>
  <verify>
1. Troubleshooting section visible when clicking "疑難排解" in sidebar
2. Error table displays 6+ common error messages with solutions
3. Webhook checklist displays 5 checkable items
4. Flowchart displays decision tree for order troubleshooting
5. Responsive layout on mobile
  </verify>
  <done>
- Error message reference table with 6 common errors
- Webhook debugging checklist with 5 items
- Order troubleshooting flowchart
- Consistent styling with other sections
- GUIDE-04 requirement satisfied
  </done>
</task>

</tasks>

<verification>
1. PHP syntax validation passes for updated UserGuidePage.php
2. FAQ section: 4 categories, 8+ questions, accordion functionality works
3. Troubleshooting section: error table, checklist, flowchart all display correctly
4. Internal links between FAQ and Troubleshooting sections work
5. All content in Traditional Chinese
6. Responsive layout on mobile devices
</verification>

<success_criteria>
1. GUIDE-04: Common FAQ answers provided for all 4 categories mentioned in CONTEXT.md
2. Error message reference table covers common PayUNi errors
3. Webhook debugging checklist helps merchants self-diagnose issues
4. Flowchart provides visual troubleshooting guidance
5. Accordion UI provides clean, scannable interface
</success_criteria>

<output>
After completion, create `.planning/phases/11-user-guidance-and-documentation/11-02-SUMMARY.md`
</output>
