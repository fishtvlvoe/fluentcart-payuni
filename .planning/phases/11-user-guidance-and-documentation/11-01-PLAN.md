---
phase: 11-user-guidance-and-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/Admin/UserGuidePage.php
  - assets/css/payuni-user-guide.css
  - assets/js/payuni-user-guide.js
  - fluentcart-payuni.php
autonomous: true

must_haves:
  truths:
    - "Admin menu contains 'PayUNi -> User Guide' submenu item"
    - "User Guide page displays left sidebar navigation + right content area"
    - "Quick Start section explains PayUNi setup and links to key features"
    - "Sidebar navigation allows switching between content sections"
    - "Page follows WordPress Codex visual style (clean, documentation-like)"
  artifacts:
    - path: "src/Admin/UserGuidePage.php"
      provides: "User guide admin page with sidebar navigation"
      min_lines: 200
      exports: ["UserGuidePage"]
    - path: "assets/css/payuni-user-guide.css"
      provides: "Styling for sidebar navigation and content layout"
      min_lines: 100
    - path: "assets/js/payuni-user-guide.js"
      provides: "JavaScript for sidebar navigation and section switching"
      min_lines: 50
  key_links:
    - from: "fluentcart-payuni.php"
      to: "src/Admin/UserGuidePage.php"
      via: "bootstrap instantiation"
      pattern: "new.*UserGuidePage"
    - from: "src/Admin/UserGuidePage.php"
      to: "assets/css/payuni-user-guide.css"
      via: "wp_enqueue_style"
      pattern: "payuni-user-guide"
---

<objective>
Create PayUNi User Guide admin page with sidebar navigation and Quick Start section.

Purpose: Provide merchants with a central documentation hub following WordPress Codex visual style, enabling them to quickly understand PayUNi features and find relevant information.
Output: User Guide page accessible from FluentCart menu with sidebar navigation, Quick Start content, and feature location links.
</objective>

<execution_context>
@/Users/fishtv/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fishtv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/fishtv/Development/fluentcart-payuni/.planning/PROJECT.md
@/Users/fishtv/Development/fluentcart-payuni/.planning/ROADMAP.md
@/Users/fishtv/Development/fluentcart-payuni/.planning/STATE.md
@/Users/fishtv/Development/fluentcart-payuni/.planning/REQUIREMENTS.md
@/Users/fishtv/Development/fluentcart-payuni/.planning/phases/11-user-guidance-and-documentation/11-CONTEXT.md

# Reference existing admin page patterns
@/Users/fishtv/Development/fluentcart-payuni/src/Admin/SettingsPage.php
@/Users/fishtv/Development/fluentcart-payuni/src/Admin/DashboardWidget.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UserGuidePage admin class with sidebar navigation structure</name>
  <files>src/Admin/UserGuidePage.php, fluentcart-payuni.php</files>
  <action>
**Part A: Create `src/Admin/UserGuidePage.php`**

Following SettingsPage pattern:

**Class structure:**
- Namespace: `BuyGoFluentCart\PayUNi\Admin`
- Constants: `PAGE_SLUG = 'payuni-user-guide'`
- Constructor: Accept `$registerHooks` parameter (default true) for testing

**Methods:**

**1. `__construct(bool $registerHooks = true)`**
```php
if ($registerHooks) {
    add_action('admin_menu', [$this, 'registerAdminPage'], 99);
    add_action('admin_enqueue_scripts', [$this, 'enqueueAssets']);
}
```

**2. `registerAdminPage(): void`**
```php
add_submenu_page(
    'fluent-cart',
    __('PayUNi 使用指南', 'fluentcart-payuni'),
    __('PayUNi 使用指南', 'fluentcart-payuni'),
    'manage_fluentcart',
    self::PAGE_SLUG,
    [$this, 'renderPage'],
    10  // Position after Dashboard (5) and Webhook Logs
);
```

**3. `enqueueAssets(string $hook): void`**
- Only load on user guide page: `if (strpos($hook, self::PAGE_SLUG) === false) return;`
- Enqueue `payuni-user-guide.css` and `payuni-user-guide.js`
- Localize script with section data

**4. `renderPage(): void`**

Render WordPress Codex-style layout:

```html
<div class="wrap payuni-user-guide">
    <h1>PayUNi 使用指南</h1>
    <div class="guide-container">
        <nav class="guide-sidebar">
            <ul class="guide-nav">
                <li><a href="#quick-start" class="active">快速開始</a></li>
                <li><a href="#feature-locations">功能位置</a></li>
                <li><a href="#faq">常見問題</a></li>
                <li><a href="#troubleshooting">疑難排解</a></li>
            </ul>
        </nav>
        <main class="guide-content">
            <!-- Quick Start section -->
            <!-- Feature Locations section (placeholder) -->
            <!-- FAQ section (placeholder - Plan 02) -->
            <!-- Troubleshooting section (placeholder - Plan 02) -->
        </main>
    </div>
</div>
```

**5. `renderQuickStartSection(): string`**

Return HTML for Quick Start content:

- **首次設定步驟**:
  1. 取得 PayUNi 商店代號 (MerID)
  2. 設定 Hash Key 和 Hash IV
  3. 在 PayUNi 後台設定 Webhook URL
  4. 測試交易

- **快速連結** (4 cards):
  - PayUNi 設定 → `admin.php?page=payuni-settings`
  - Webhook 記錄 → `admin.php?page=payuni-webhook-logs`
  - PayUNi Dashboard → `admin.php?page=payuni-dashboard`
  - FluentCart 訂單 → `admin.php?page=fluent-cart#/orders`

**6. `renderFeatureLocationsSection(): string`**

Return HTML for feature location reference:

- **訂單交易資訊**: FluentCart 訂單詳情 → PayUNi 交易資訊區塊
- **訂閱續扣歷史**: FluentCart 訂閱詳情 → PayUNi 訂閱資訊區塊
- **Webhook 記錄**: WordPress 後台 → FluentCart → Webhook 記錄
- **Dashboard 統計**: WordPress 後台 → FluentCart → PayUNi Dashboard
- **憑證設定**: WordPress 後台 → FluentCart → 付款設定 → PayUNi

Each location has: 功能名稱, 位置路徑, 簡短說明

**Part B: Integrate into `fluentcart-payuni.php`**

Add after DashboardWidget registration:

```php
// PayUNi User Guide：使用者說明文件頁面
if (class_exists('BuyGoFluentCart\\PayUNi\\Admin\\UserGuidePage')) {
    new \BuyGoFluentCart\PayUNi\Admin\UserGuidePage();
}
```
  </action>
  <verify>
1. File exists at `src/Admin/UserGuidePage.php`
2. PHP syntax valid: `php -l src/Admin/UserGuidePage.php`
3. Class is loadable via autoloader
4. Bootstrap integration added to fluentcart-payuni.php
  </verify>
  <done>
- UserGuidePage class created with sidebar navigation structure
- Quick Start section with setup steps and quick links
- Feature Locations section with reference table
- Bootstrap integration with class_exists guard
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CSS and JavaScript for sidebar navigation and section switching</name>
  <files>assets/css/payuni-user-guide.css, assets/js/payuni-user-guide.js</files>
  <action>
**Part A: Create `assets/css/payuni-user-guide.css`**

WordPress Codex-inspired styling:

```css
/* Container Layout */
.payuni-user-guide .guide-container {
    display: flex;
    gap: 30px;
    max-width: 1200px;
    margin-top: 20px;
}

/* Sidebar Navigation */
.payuni-user-guide .guide-sidebar {
    width: 220px;
    flex-shrink: 0;
    position: sticky;
    top: 32px;  /* WordPress admin bar height */
    align-self: flex-start;
}

.payuni-user-guide .guide-nav {
    list-style: none;
    margin: 0;
    padding: 0;
    background: #fff;
    border: 1px solid #dcdcde;
    border-radius: 4px;
}

.payuni-user-guide .guide-nav li a {
    display: block;
    padding: 12px 16px;
    color: #1d2327;
    text-decoration: none;
    border-bottom: 1px solid #dcdcde;
    transition: background-color 0.2s;
}

.payuni-user-guide .guide-nav li:last-child a {
    border-bottom: none;
}

.payuni-user-guide .guide-nav li a:hover {
    background-color: #f6f7f7;
}

.payuni-user-guide .guide-nav li a.active {
    background-color: #2271b1;
    color: #fff;
}

/* Main Content Area */
.payuni-user-guide .guide-content {
    flex: 1;
    background: #fff;
    padding: 24px;
    border: 1px solid #dcdcde;
    border-radius: 4px;
}

/* Content Sections */
.payuni-user-guide .guide-section {
    display: none;
}

.payuni-user-guide .guide-section.active {
    display: block;
}

/* Quick Start Cards */
.payuni-user-guide .quick-links-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 20px;
}

.payuni-user-guide .quick-link-card {
    display: flex;
    align-items: center;
    padding: 16px;
    background: #f6f7f7;
    border: 1px solid #dcdcde;
    border-radius: 4px;
    text-decoration: none;
    color: #1d2327;
    transition: border-color 0.2s, background-color 0.2s;
}

.payuni-user-guide .quick-link-card:hover {
    border-color: #2271b1;
    background-color: #f0f6fc;
}

.payuni-user-guide .quick-link-card .dashicons {
    font-size: 24px;
    width: 24px;
    height: 24px;
    margin-right: 12px;
    color: #2271b1;
}

/* Setup Steps */
.payuni-user-guide .setup-steps {
    counter-reset: step;
    list-style: none;
    padding-left: 0;
}

.payuni-user-guide .setup-steps li {
    position: relative;
    padding-left: 40px;
    margin-bottom: 16px;
    counter-increment: step;
}

.payuni-user-guide .setup-steps li::before {
    content: counter(step);
    position: absolute;
    left: 0;
    width: 28px;
    height: 28px;
    background: #2271b1;
    color: #fff;
    border-radius: 50%;
    text-align: center;
    line-height: 28px;
    font-weight: 600;
}

/* Feature Locations Table */
.payuni-user-guide .feature-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
}

.payuni-user-guide .feature-table th,
.payuni-user-guide .feature-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #dcdcde;
}

.payuni-user-guide .feature-table th {
    background: #f6f7f7;
    font-weight: 600;
}

/* Responsive */
@media (max-width: 782px) {
    .payuni-user-guide .guide-container {
        flex-direction: column;
    }

    .payuni-user-guide .guide-sidebar {
        width: 100%;
        position: static;
    }

    .payuni-user-guide .guide-nav {
        display: flex;
        flex-wrap: wrap;
    }

    .payuni-user-guide .guide-nav li {
        flex: 1;
        min-width: 120px;
    }

    .payuni-user-guide .guide-nav li a {
        text-align: center;
        border-bottom: none;
        border-right: 1px solid #dcdcde;
    }
}
```

**Part B: Create `assets/js/payuni-user-guide.js`**

Section switching functionality:

```javascript
(function($) {
    'use strict';

    $(document).ready(function() {
        var $nav = $('.guide-nav');
        var $sections = $('.guide-section');

        // Handle navigation clicks
        $nav.on('click', 'a', function(e) {
            e.preventDefault();

            var targetId = $(this).attr('href').substring(1);
            var $targetSection = $('#' + targetId);

            // Update active nav item
            $nav.find('a').removeClass('active');
            $(this).addClass('active');

            // Show target section
            $sections.removeClass('active');
            $targetSection.addClass('active');

            // Update URL hash without scrolling
            history.replaceState(null, null, '#' + targetId);
        });

        // Handle initial hash on page load
        var hash = window.location.hash.substring(1);
        if (hash && $('#' + hash).length) {
            $nav.find('a[href="#' + hash + '"]').trigger('click');
        } else {
            // Default to first section
            $nav.find('a').first().addClass('active');
            $sections.first().addClass('active');
        }

        // Smooth scroll for internal links
        $('.guide-content').on('click', 'a[href^="#"]', function(e) {
            var targetId = $(this).attr('href').substring(1);
            if ($('#' + targetId).length) {
                $nav.find('a[href="#' + targetId + '"]').trigger('click');
                e.preventDefault();
            }
        });
    });
})(jQuery);
```
  </action>
  <verify>
1. CSS file exists at `assets/css/payuni-user-guide.css`
2. JS file exists at `assets/js/payuni-user-guide.js`
3. Visit User Guide page in browser: sidebar displays, section switching works
4. Responsive: sidebar collapses to horizontal on mobile
  </verify>
  <done>
- CSS implements WordPress Codex-inspired styling
- Sidebar navigation with active state
- Quick links grid with hover effects
- Setup steps with numbered circles
- Feature locations table styling
- Responsive layout for mobile
- JavaScript section switching with URL hash support
  </done>
</task>

</tasks>

<verification>
1. PHP syntax validation passes for UserGuidePage.php
2. Admin menu shows "PayUNi 使用指南" under FluentCart menu
3. Page displays sidebar + content layout (WordPress Codex style)
4. Quick Start section shows 4 setup steps and 4 quick link cards
5. Feature Locations section shows reference table
6. Clicking sidebar nav items switches content sections
7. URL hash updates when switching sections (#quick-start, #feature-locations)
8. Responsive: sidebar horizontal on mobile (<782px)
</verification>

<success_criteria>
1. GUIDE-01: Admin menu contains "PayUNi -> User Guide" page
2. GUIDE-02: Quick Start section with setup steps and feature links
3. GUIDE-03: Feature Locations reference table (screenshots deferred - screenshot placeholder text)
4. Page structure supports FAQ and Troubleshooting sections (Plan 02)
5. Consistent with FluentCart admin UI patterns
</success_criteria>

<output>
After completion, create `.planning/phases/11-user-guidance-and-documentation/11-01-SUMMARY.md`
</output>
